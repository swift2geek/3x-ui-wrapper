#!/bin/bash

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ 3x-ui
echo "üîÑ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 3x-ui..."
bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)

# –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –ø–∞–Ω–µ–ª–∏
sleep 5

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–∞–Ω–µ–ª–∏
echo "üîç –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏..."
USERNAME=$(x-ui settings -show true | grep -Eo 'username: .+' | awk '{print $2}')
PASSWORD=$(x-ui settings -show true | grep -Eo 'password: .+' | awk '{print $2}')
PORT=$(x-ui settings -show true | grep -Eo 'port: .+' | awk '{print $2}')
WEB_BASE_PATH=$(x-ui settings -show true | grep -Eo 'webBasePath: .+' | awk '{print $2}')
SERVER_IP=$(curl -s https://api.ipify.org)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–¥–∞–ª–æ—Å—å –ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
if [[ -z "$USERNAME" || -z "$PASSWORD" || -z "$PORT" || -z "$WEB_BASE_PATH" ]]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ x-ui."
    exit 1
fi

# –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
ACCESS_URL="http://$SERVER_IP:$PORT$WEB_BASE_PATH"

echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
echo "‚îÇ  üó°Ô∏è  ùïäùï•ùïñùïíùïùùï•ùïô ùïÑùï†ùïïùïñ ùî∏ùïîùï•ùïöùïßùïíùï•ùïñùïï!  üó°Ô∏è ‚îÇ"
echo "‚îÇ    ‚öîÔ∏è   ùïè-ùïåùïÄ ùïäùïñùï•ùï¶ùï° ùïäùï¶ùïîùïîùïñùï§ùï§ùïóùï¶ùïù!   ‚öîÔ∏è    ‚îÇ"
echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§"
echo "‚îÇ üåç –î–æ—Å—Ç—É–ø:       $ACCESS_URL"
echo "‚îÇ üë§ –õ–æ–≥–∏–Ω:        $USERNAME"
echo "‚îÇ üîë –ü–∞—Ä–æ–ª—å:       $PASSWORD"
echo "‚îÇ üìÇ WebBasePath:  $WEB_BASE_PATH"
echo "‚îÇ üéØ –ü–∞–Ω–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç: $PORT"
echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"

# üî• **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º UFW**
echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º UFW..."
ufw status >/dev/null 2>&1 || yes | ufw enable

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç
ufw allow "$PORT"/tcp
ufw allow "$PORT"/udp

# –î–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã (SSH, HTTP, HTTPS, CDN)
ufw allow 22/tcp
ufw allow 443/tcp
ufw allow 80/tcp
ufw allow 2053/tcp

ufw reload
echo "‚úÖ –û—Ç–∫—Ä—ã–ª–∏ –ø–æ—Ä—Ç—ã $PORT, 22, 443, 80, 2053 –≤ UFW"